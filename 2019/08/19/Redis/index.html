<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content>
  <meta name="author" content="Mr Wang">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Redisæ€»ç»“">
  <meta property="og:description" content>
  <meta property="og:site_name" content="æ˜¥é£ä¸åŠä½ çš„ç¾ğŸ·">
  <meta property="og:type" content="article">
  <meta property="og:image" content="http://yoursite.com">
  
    <link rel="alternate" href="/atom.xml" title="æ˜¥é£ä¸åŠä½ çš„ç¾ğŸ·" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>æ˜¥é£ä¸åŠä½ çš„ç¾ğŸ·</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Redisæ€»ç»“</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/<your-github-username>">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:<your-email-address>">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Mr Wang</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2019-08-19</span>
            <span class="time">17:13:27</span>
          </span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p><strong>RedisæŒä¹…åŒ–-RDB</strong><br>RDB æ˜¯ Redis é»˜è®¤çš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œæ‰§è¡ŒæŒ‡å®šæ¬¡æ•°çš„å†™æ“ä½œï¼Œåˆ™ä¼šå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚å³åœ¨æŒ‡å®šç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªdump.rdbæ–‡ä»¶ã€‚Redis é‡å¯ä¼šé€šè¿‡åŠ è½½dump.rdbæ–‡ä»¶æ¢å¤æ•°æ®ã€‚<br> å¯åŠ¨reids:redis-server /usr/local/redis/redis conf<br>è¿æ¥redis:redis-cli -h 127.0.0.1 -p 6379 </p>
<p><strong>ä»é…ç½®æ–‡ä»¶äº†è§£RDB(redis.conf)</strong>  </p>
<pre><code>################################ SNAPSHOTTING  ################################
#
# Save the DB on disk:
#
#   save &lt;seconds&gt; &lt;changes&gt;
#
#   Will save the DB if both the given number of seconds and the given
#   number of write operations against the DB occurred.
#
#   In the example below the behaviour will be to save:
#   after 900 sec (15 min) if at least 1 key changed
#   after 300 sec (5 min) if at least 10 keys changed
#   after 60 sec if at least 10000 keys changed
#
#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.
#
#   It is also possible to remove all the previously configured save
#   points by adding a save directive with a single empty string argument
#   like in the following example:
#
#   save &quot;&quot;

save 900 1
save 300 10
save 60 10000</code></pre><p>save &lt;æŒ‡å®šæ—¶é—´é—´éš”&gt; &lt;æ‰§è¡ŒæŒ‡å®šæ¬¡æ•°æ›´æ–°æ“ä½œ&gt;ï¼Œæ»¡è¶³æ¡ä»¶å°±å°†å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ä¸­ã€‚å®˜æ–¹å‡ºå‚é…ç½®é»˜è®¤æ˜¯ 900ç§’å†…æœ‰1ä¸ªæ›´æ”¹ï¼Œ300ç§’å†…æœ‰10ä¸ªæ›´æ”¹ä»¥åŠ60ç§’å†…æœ‰10000ä¸ªæ›´æ”¹ï¼Œåˆ™å°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥ç£ç›˜ã€‚<br>è‹¥ä¸æƒ³ç”¨RDBæ–¹æ¡ˆï¼Œå¯ä»¥æŠŠ save â€œâ€ çš„æ³¨é‡Šæ‰“å¼€ï¼Œä¸‹é¢ä¸‰ä¸ªæ³¨é‡Š.  </p>
<p><strong>è§¦å‘RDBå¿«ç…§</strong><br>1 åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œæ‰§è¡ŒæŒ‡å®šæ¬¡æ•°çš„å†™æ“ä½œ<br>2 æ‰§è¡Œsaveï¼ˆé˜»å¡ï¼Œ åªç®¡ä¿å­˜å¿«ç…§ï¼Œå…¶ä»–çš„ç­‰å¾…ï¼‰ æˆ–è€…æ˜¯bgsave ï¼ˆå¼‚æ­¥ï¼‰å‘½ä»¤<br>3 æ‰§è¡Œflushall å‘½ä»¤ï¼Œæ¸…ç©ºæ•°æ®åº“æ‰€æœ‰æ•°æ®ï¼Œæ„ä¹‰ä¸å¤§ã€‚<br>4 æ‰§è¡Œshutdown å‘½ä»¤ï¼Œä¿è¯æœåŠ¡å™¨æ­£å¸¸å…³é—­ä¸”ä¸ä¸¢å¤±ä»»ä½•æ•°æ®ï¼Œæ„ä¹‰â€¦ä¹Ÿä¸å¤§ã€‚  </p>
<p><strong>RDB çš„ä¼˜ç¼ºç‚¹</strong><br>1.æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ä¸é«˜ï¼Œå› ä¸ºRDBå¯èƒ½åœ¨æœ€åä¸€æ¬¡å¤‡ä»½æ—¶å®•æœºäº†ã€‚<br>2.å¤‡ä»½æ—¶å ç”¨å†…å­˜ï¼Œå› ä¸ºRedis åœ¨å¤‡ä»½æ—¶ä¼šç‹¬ç«‹åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆæ­¤æ—¶å†…å­˜ä¸­çš„æ•°æ®æ˜¯åŸæ¥çš„ä¸¤å€å“¦ï¼‰ï¼Œæœ€åå†å°†ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¹‹å‰çš„å¤‡ä»½æ–‡ä»¶ã€‚æ‰€ä»¥Redis çš„æŒä¹…åŒ–å’Œæ•°æ®çš„æ¢å¤è¦é€‰æ‹©åœ¨å¤œæ·±äººé™çš„æ—¶å€™æ‰§è¡Œæ˜¯æ¯”è¾ƒåˆç†çš„ã€‚ </p>
<p> <strong>RedisæŒä¹…åŒ–-AOF</strong><br>AOF ï¼šRedis é»˜è®¤ä¸å¼€å¯ã€‚å®ƒçš„å‡ºç°æ˜¯ä¸ºäº†å¼¥è¡¥RDBçš„ä¸è¶³ï¼ˆæ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼‰ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå¹¶è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚Redis é‡å¯çš„ä¼šæ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚  </p>
<p><strong>ä»é…ç½®æ–‡ä»¶äº†è§£AOF(redis.conf)</strong>  </p>
<pre><code>############################## APPEND ONLY MODE ###############################

appendonly no


appendfilename &quot;appendonly.aof&quot;

# appendfsync always
appendfsync everysec
# appendfsync no

no-appendfsync-on-rewrite no

auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
</code></pre><p>1.redis é»˜è®¤å…³é—­ï¼Œå¼€å¯éœ€è¦æ‰‹åŠ¨æŠŠnoæ”¹ä¸ºyes  </p>
<p>2.æŒ‡å®šæ—¥å¿—æ›´æ–°æ¡ä»¶<br>alwaysï¼šåŒæ­¥æŒä¹…åŒ–ï¼Œæ¯æ¬¡å‘ç”Ÿæ•°æ®å˜åŒ–ä¼šç«‹åˆ»å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚æ€§èƒ½è¾ƒå·®å½“æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰<br>everysecï¼šå‡ºå‚é»˜è®¤æ¨èï¼Œæ¯ç§’å¼‚æ­¥è®°å½•ä¸€æ¬¡ï¼ˆé»˜è®¤å€¼ï¼‰<br>noï¼šä¸åŒæ­¥<br>3.é…ç½®é‡å†™è§¦å‘æœºåˆ¶,auto-aof-rewrite-percentage 100,auto-aof-rewrite-min-size 64mb,å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ã€‚ä¸€èˆ¬éƒ½è®¾ç½®ä¸º3Gï¼Œ64Må¤ªå°äº†ã€‚  </p>
<hr>
<p><strong>Redis ä¸»ä»å¤åˆ¶</strong><br>ä¸»ä»å¤åˆ¶çš„ä½œç”¨:<br>       ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ï¼Œå®¹ç¾æ¢å¤ã€‚ä¸€å°ä¸»æœºè´Ÿè´£å†™å…¥æ•°æ®ï¼Œå¤šå°ä»æœºè´Ÿè´£å¤‡ä»½æ•°æ®ã€‚åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå³ä¾¿æ˜¯ä¸»æœºæŒ‚äº†ï¼Œå¯ä»¥ç”¨ä»æœºä»£æ›¿ä¸»æœºç»§ç»­å·¥ä½œï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚è¯»å†™åˆ†ç¦»ï¼Œè®©è¯»å¤šå†™å°‘çš„åº”ç”¨æ€§èƒ½æ›´ä½³(ä¸€ä¸ªå‘½ä»¤ï¼š slaveof ä¸»æœºip ä¸»æœºport ï¼Œå°±å¯ä»¥ç¡®å®šä¸»ä»å…³ç³»ï¼›ä¸€ä¸ªå‘½ä»¤ï¼š./redis-sentinel sentinel.conf ï¼Œå°±å¯ä»¥å¼€å¯å“¨å…µç›‘æ§ã€‚)</p>
<pre><code>192.168.31.80:6380&gt; clear
192.168.31.80:6380&gt; info replication
# Replication
role:slave
master_host:192.168.31.196
master_port:6379
master_link_status:up
master_last_io_seconds_ago:4
master_sync_in_progress:0
slave_repl_offset:224
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:328772b91d47b4969324f3889c7347279e73dbe8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:224
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:224
192.168.31.80:6380&gt; 

</code></pre><pre><code>192.168.31.80:6380&gt; clear
192.168.31.80:6380&gt; info replication
# Replication
role:slave
master_host:192.168.31.196
master_port:6379
master_link_status:up
master_last_io_seconds_ago:4
master_sync_in_progress:0
slave_repl_offset:224
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:328772b91d47b4969324f3889c7347279e73dbe8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:224
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:224
192.168.31.80:6380&gt; 
</code></pre><pre><code>192.168.31.80:6380&gt; clear
192.168.31.80:6380&gt; info replication
# Replication
role:slave
master_host:192.168.31.196
master_port:6379
master_link_status:up
master_last_io_seconds_ago:4
master_sync_in_progress:0
slave_repl_offset:224
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:328772b91d47b4969324f3889c7347279e73dbe8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:224
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:224
192.168.31.80:6380&gt; 
</code></pre><p><strong>ä¸»ä»å¤åˆ¶çš„åŸç†</strong><br><strong>å…¨é‡å¤åˆ¶</strong><br>å®ç°åŸç†ï¼šå»ºç«‹ä¸»ä»å…³ç³»æ—¶ï¼Œä»æœºä¼šç»™ä¸»æœºå‘é€syncå‘½ä»¤ï¼Œä¸»æœºæ¥æ”¶å‘½ä»¤ï¼Œåå°å¯åŠ¨çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰ç”¨äºä¿®æ”¹å‘½ä»¤ï¼Œä¼ é€ç»™ä»æœºã€‚<br><strong>å¢é‡å¤åˆ¶</strong><br>å®ç°åŸç†ï¼šä¸»æœºä¼šç»§ç»­å°†æ–°æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ä»æœºï¼Œå®ç°æ•°æ®çš„åŒæ­¥æ•ˆæœã€‚  </p>
<p><strong>ä¸»ä»å¤åˆ¶çš„ç¼ºç‚¹</strong><br>Redisçš„ä¸»ä»å¤åˆ¶æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯å»¶è¿Ÿï¼Œä¸»æœºè´Ÿè´£å†™ï¼Œä»æœºè´Ÿè´£å¤‡ä»½ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼Œä»æœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p>
<hr>
<p><strong>SpringBooté›†æˆRedis</strong>  </p>
<pre><code>// é…ç½®keyç”Ÿæˆå™¨ï¼Œä½œç”¨äºç¼“å­˜ç®¡ç†å™¨ç®¡ç†çš„æ‰€æœ‰ç¼“å­˜
    // å¦‚æœç¼“å­˜æ³¨è§£ï¼ˆ@Cacheableã€@CacheEvictç­‰ï¼‰ä¸­æŒ‡å®škeyå±æ€§ï¼Œé‚£ä¹ˆä¼šè¦†ç›–æ­¤keyç”Ÿæˆå™¨
    @Bean
    public KeyGenerator keyGenerator() {
        return (target, method, params) -&gt; {
            StringBuilder sb = new StringBuilder();
            sb.append(target.getClass().getName());
            sb.append(method.getName());
            for (Object obj : params) {
                sb.append(obj.toString());
            }
            return sb.toString();
        };
    }</code></pre><pre><code>@Bean
    public CacheManager cacheManager(RedisConnectionFactory factory) {
        RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer();
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);

        //è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);

        // é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´30ç§’
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofSeconds(30))
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))
                .disableCachingNullValues();

        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)
                .cacheDefaults(config)
                .build();
        return cacheManager;
    }</code></pre><pre><code>/**
     * retemplateç›¸å…³é…ç½®
     * @param factory
     * @return
     */
    @Bean
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {

        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();
        // é…ç½®è¿æ¥å·¥å‚
        template.setConnectionFactory(factory);

        //ä½¿ç”¨Jackson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼ï¼ˆé»˜è®¤ä½¿ç”¨JDKçš„åºåˆ—åŒ–æ–¹å¼ï¼‰
        Jackson2JsonRedisSerializer jacksonSeial = new Jackson2JsonRedisSerializer(Object.class);

        ObjectMapper om = new ObjectMapper();
        // æŒ‡å®šè¦åºåˆ—åŒ–çš„åŸŸï¼Œfield,getå’Œset,ä»¥åŠä¿®é¥°ç¬¦èŒƒå›´ï¼ŒANYæ˜¯éƒ½æœ‰åŒ…æ‹¬privateå’Œpublic
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        // æŒ‡å®šåºåˆ—åŒ–è¾“å…¥çš„ç±»å‹ï¼Œç±»å¿…é¡»æ˜¯éfinalä¿®é¥°çš„ï¼Œfinalä¿®é¥°çš„ç±»ï¼Œæ¯”å¦‚String,Integerç­‰ä¼šè·‘å‡ºå¼‚å¸¸
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jacksonSeial.setObjectMapper(om);

        // å€¼é‡‡ç”¨jsonåºåˆ—åŒ–
        template.setValueSerializer(jacksonSeial);
        //jdkåºåˆ—åŒ–å€¼,å¯è¯»æ€§å·®,æ˜¯å­—èŠ‚æ•°
        //  template.setValueSerializer(new JdkSerializationRedisSerializer());
        //ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼
        template.setKeySerializer(new StringRedisSerializer());


        // è®¾ç½®hash key å’Œvalueåºåˆ—åŒ–æ¨¡å¼
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(jacksonSeial);
        template.afterPropertiesSet();

        return template;
    }</code></pre><pre><code>@Component
public class RedisUtil {
    @Resource
    private RedisTemplate&lt;String, Object&gt; redisTemplate;

    public void setRedisTemplate(RedisTemplate&lt;String, Object&gt; redisTemplate) {
        this.redisTemplate = redisTemplate;
    }
    //=============================common============================
    /**
     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´
     * @param key é”®
     * @param time æ—¶é—´(ç§’)
     * @return
     */
    public boolean expire(String key,long time){
        try {
            if(time&gt;0){
                redisTemplate.expire(key, time, TimeUnit.SECONDS);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ
     */
    public long getExpire(String key){
        return redisTemplate.getExpire(key,TimeUnit.SECONDS);
    }

    /**
     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
     * @param key é”®
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean hasKey(String key){
        try {
            return redisTemplate.hasKey(key);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * åˆ é™¤ç¼“å­˜
     * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public void del(String ... key){
        if(key!=null&amp;&amp;key.length&gt;0){
            if(key.length==1){
                redisTemplate.delete(key[0]);
            }else{
                redisTemplate.delete(CollectionUtils.arrayToList(key));
            }
        }
    }

    //============================String=============================
    /**
     * æ™®é€šç¼“å­˜è·å–
     * @param key é”®
     * @return å€¼
     */
    public Object get(String key){
        return key==null?null:redisTemplate.opsForValue().get(key);
    }

    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥
     * @param key é”®
     * @param value å€¼
     * @return trueæˆåŠŸ falseå¤±è´¥
     */
    public boolean set(String key,Object value) {
        try {
            redisTemplate.opsForValue().set(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }

    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´
     * @param key é”®
     * @param value å€¼
     * @param time æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ
     * @return trueæˆåŠŸ false å¤±è´¥
     */
    public boolean set(String key,Object value,long time){
        try {
            if(time&gt;0){
                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);
            }else{
                set(key, value);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * é€’å¢
     * @param key é”®
     * @param delta è¦å¢åŠ å‡ (å¤§äº0)
     * @return
     */
    public long incr(String key, long delta){
        if(delta&lt;0){
            throw new RuntimeException(&quot;é€’å¢å› å­å¿…é¡»å¤§äº0&quot;);
        }
        return redisTemplate.opsForValue().increment(key, delta);
    }

    /**
     * é€’å‡
     * @param key é”®
     * @param delta è¦å‡å°‘å‡ (å°äº0)
     * @return
     */
    public long decr(String key, long delta){
        if(delta&lt;0){
            throw new RuntimeException(&quot;é€’å‡å› å­å¿…é¡»å¤§äº0&quot;);
        }
        return redisTemplate.opsForValue().increment(key, -delta);
    }

    //================================Map=================================
    /**
     * HashGet
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     * @return å€¼
     */
    public Object hget(String key,String item){
        return redisTemplate.opsForHash().get(key, item);
    }

    /**
     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼
     * @param key é”®
     * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼
     */
    public Map&lt;Object,Object&gt; hmget(String key){
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * HashSet
     * @param key é”®
     * @param map å¯¹åº”å¤šä¸ªé”®å€¼
     * @return true æˆåŠŸ false å¤±è´¥
     */
    public boolean hmset(String key, Map&lt;String,Object&gt; map){
        try {
            redisTemplate.opsForHash().putAll(key, map);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * HashSet å¹¶è®¾ç½®æ—¶é—´
     * @param key é”®
     * @param map å¯¹åº”å¤šä¸ªé”®å€¼
     * @param time æ—¶é—´(ç§’)
     * @return trueæˆåŠŸ falseå¤±è´¥
     */
    public boolean hmset(String key, Map&lt;String,Object&gt; map, long time){
        try {
            redisTemplate.opsForHash().putAll(key, map);
            if(time&gt;0){
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     * @param key é”®
     * @param item é¡¹
     * @param value å€¼
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public boolean hset(String key,String item,Object value) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     * @param key é”®
     * @param item é¡¹
     * @param value å€¼
     * @param time æ—¶é—´(ç§’)  æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public boolean hset(String key,String item,Object value,long time) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            if(time&gt;0){
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * åˆ é™¤hashè¡¨ä¸­çš„å€¼
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull
     */
    public void hdel(String key, Object... item){
        redisTemplate.opsForHash().delete(key,item);
    }

    /**
     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean hHasKey(String key, String item){
        return redisTemplate.opsForHash().hasKey(key, item);
    }

    /**
     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›
     * @param key é”®
     * @param item é¡¹
     * @param by è¦å¢åŠ å‡ (å¤§äº0)
     * @return
     */
    public double hincr(String key, String item,double by){
        return redisTemplate.opsForHash().increment(key, item, by);
    }

    /**
     * hashé€’å‡
     * @param key é”®
     * @param item é¡¹
     * @param by è¦å‡å°‘è®°(å°äº0)
     * @return
     */
    public double hdecr(String key, String item,double by){
        return redisTemplate.opsForHash().increment(key, item,-by);
    }

    //============================set=============================
    /**
     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼
     * @param key é”®
     * @return
     */
    public Set&lt;Object&gt; sGet(String key){
        try {
            return redisTemplate.opsForSet().members(key);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨
     * @param key é”®
     * @param value å€¼
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean sHasKey(String key,Object value){
        try {
            return redisTemplate.opsForSet().isMember(key, value);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜
     * @param key é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public long sSet(String key, Object...values) {
        try {
            return redisTemplate.opsForSet().add(key, values);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜
     * @param key é”®
     * @param time æ—¶é—´(ç§’)
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public long sSetAndTime(String key,long time,Object...values) {
        try {
            Long count = redisTemplate.opsForSet().add(key, values);
            if(time&gt;0) expire(key, time);
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * è·å–setç¼“å­˜çš„é•¿åº¦
     * @param key é”®
     * @return
     */
    public long sGetSetSize(String key){
        try {
            return redisTemplate.opsForSet().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * ç§»é™¤å€¼ä¸ºvalueçš„
     * @param key é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return ç§»é™¤çš„ä¸ªæ•°
     */
    public long setRemove(String key, Object ...values) {
        try {
            Long count = redisTemplate.opsForSet().remove(key, values);
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }
    //===============================list=================================

    /**
     * è·å–listç¼“å­˜çš„å†…å®¹
     * @param key é”®
     * @param start å¼€å§‹
     * @param end ç»“æŸ  0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼
     * @return
     */
    public List&lt;Object&gt; lGet(String key, long start, long end){
        try {
            return redisTemplate.opsForList().range(key, start, end);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * è·å–listç¼“å­˜çš„é•¿åº¦
     * @param key é”®
     * @return
     */
    public long lGetListSize(String key){
        try {
            return redisTemplate.opsForList().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼
     * @param key é”®
     * @param index ç´¢å¼•  index&gt;=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index&lt;0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨
     * @return
     */
    public Object lGetIndex(String key,long index){
        try {
            return redisTemplate.opsForList().index(key, index);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key é”®
     * @param value å€¼
     * @param time æ—¶é—´(ç§’)
     * @return
     */
    public boolean lSet(String key, Object value) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key é”®
     * @param value å€¼
     * @param time æ—¶é—´(ç§’)
     * @return
     */
    public boolean lSet(String key, Object value, long time) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            if (time &gt; 0) expire(key, time);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key é”®
     * @param value å€¼
     * @param time æ—¶é—´(ç§’)
     * @return
     */
    public boolean lSet(String key, List&lt;Object&gt; value) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key é”®
     * @param value å€¼
     * @param time æ—¶é—´(ç§’)
     * @return
     */
    public boolean lSet(String key, List&lt;Object&gt; value, long time) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            if (time &gt; 0) expire(key, time);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®
     * @param key é”®
     * @param index ç´¢å¼•
     * @param value å€¼
     * @return
     */
    public boolean lUpdateIndex(String key, long index,Object value) {
        try {
            redisTemplate.opsForList().set(key, index, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue
     * @param key é”®
     * @param count ç§»é™¤å¤šå°‘ä¸ª
     * @param value å€¼
     * @return ç§»é™¤çš„ä¸ªæ•°
     */
    public long lRemove(String key,long count,Object value) {
        try {
            Long remove = redisTemplate.opsForList().remove(key, count, value);
            return remove;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

}</code></pre>
        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

